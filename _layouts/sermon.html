---
layout: default
---

<div class="bg-saints-100 dark:bg-saints-black">
  <main tabindex="-1" id="main-content" class="py-4 px-6 pt-6 pb-16 mx-auto max-w-7xl lg:px-8 lg:pt-20">
    <!-- Breadcrumb -->
    <div class="animate-reveal">
      {% include breadcrumbs.html %}
    </div>

    <article itemscope itemtype="https://schema.org/Article">
      <!-- Title and Subscribe Section -->
      <div class="flex flex-col gap-6 mb-6 lg:flex-row lg:justify-between lg:items-center animate-reveal">
        <!-- Title Section -->
        <div class="flex-1">
          <h1 class="mb-4 text-4xl font-semibold tracking-tight sm:text-5xl dark:text-white font-display text-stone-900" itemprop="headline name">
            {{ page.title }}
          </h1>
          {% if page.scripture != page.title %}
            <p class="text-lg text-stone-600 dark:text-stone-400">
              <cite itemprop="about citation">{{ page.scripture }}</cite>
            </p>
          {% endif %}
        </div>

        <!-- Subscribe Buttons -->
        <div class="flex flex-col gap-3 lg:min-w-[300px]">
          {% include subscribe-buttons.html %}
        </div>
      </div>

      <!-- Audio Player Section -->
      {% if page.audio_url %}
        <section aria-labelledby="sermon-audio-caption" class="mb-8 animate-reveal">
          <h2 id="sermon-audio-caption" class="sr-only">{{ page.title }} Audio</h2>
          {% include audio-player.html audio_url=page.audio_url title=page.title episode_id=page.episode_id %}
        </section>
      {% endif %}

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-4 animate-reveal">
        <!-- Metadata Sidebar -->
        <div class="order-1 lg:order-1 lg:col-span-1">
          <div class="space-y-6">
            <!-- Speaker Section -->
            {% if page.pastor %}
              <div>
                <h3 class="mb-3 font-medium uppercase text-saints-600 font-display text-[0.6rem] tracking-[1px] dark:text-stone-400">Speaker</h3>
                <div class="flex gap-3 items-center">
                  {% include pastor-image.html class="flex-shrink-0 rounded-full size-12" speaker=page.pastor %}
                  <address itemscope itemtype="https://schema.org/Person" class="not-italic">
                    <div class="text-sm dark:text-white text-stone-900" itemprop="name">{{ page.pastor | remove: "Pastor " }}</div>
                  </address>
                </div>
              </div>
            {% endif %}

            <!-- Metadata -->
            <div class="space-y-4">
              <div>
                <dt class="mb-1 font-medium uppercase text-saints-600 font-display text-[0.6rem] tracking-[1px] dark:text-stone-400">Published</dt>
                <dd>
                  <time datetime="{{ page.date | date_to_xmlschema }}" pubdate itemprop="datePublished" class="text-sm dark:text-white text-stone-900">
                    {{ page.date | date: "%B %d, %Y" }}
                  </time>
                </dd>
              </div>

              {% if page.duration %}
                <div>
                  <dt class="mb-1 font-medium uppercase text-saints-600 font-display text-[0.6rem] tracking-[1px] dark:text-stone-400">Duration</dt>
                  <dd>
                    <data value="{{ page.duration }}" itemprop="duration" class="text-sm dark:text-white text-stone-900">{{ page.duration }}</data>
                  </dd>
                </div>
              {% endif %}

              {% if page.scripture %}
                <div>
                  <dt class="mb-1 font-medium uppercase text-saints-600 font-display text-[0.6rem] tracking-[1px] dark:text-stone-400">Scripture</dt>
                  <dd>
                    <cite itemprop="about citation" class="text-sm not-italic dark:text-white text-stone-900">{{ page.scripture }}</cite>
                  </dd>
                </div>
              {% endif %}

              {% if page.series %}
                <div>
                  <dt class="mb-1 font-medium uppercase text-saints-600 font-display text-[0.6rem] tracking-[1px] dark:text-stone-400">Series</dt>
                  <dd>
                    <span itemscope itemtype="https://schema.org/CreativeWorkSeries" class="text-sm dark:text-white text-stone-900">
                      <span itemprop="name">{{ page.series }}</span>
                    </span>
                  </dd>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Sermon Content -->
        <div class="order-2 lg:order-2 lg:col-span-3">
          <div class="relative">

            {% if page.description %}
              <!-- Always show description first for SEO and user experience -->
              <div class="prose prose-base prose-stone dark:prose-invert max-w-none [&_p:has(br:only-child)]:hidden mb-8">
                {{ page.description | markdownify }}
              </div>
            {% endif %}

            {% comment %}Check for transcription content - try multiple approaches{% endcomment %}
            {% assign has_transcription = false %}
            {% assign transcription_content = "" %}

            {% comment %}Method 1: Try markdown header{% endcomment %}
            {% assign md_parts = content | split: "## Transcription" %}
            {% if md_parts.size > 1 %}
              {% assign transcription_content = md_parts[1] | strip %}
              {% assign has_transcription = true %}
            {% endif %}

            {% comment %}Method 2: Try HTML header if markdown didn't work{% endcomment %}
            {% unless has_transcription %}
              {% if content contains "<h2" and content contains "Transcription" %}
                {% assign html_parts = content | split: "Transcription</h2>" %}
                {% if html_parts.size > 1 %}
                  {% assign transcription_content = html_parts[1] | strip %}
                  {% assign has_transcription = true %}
                {% endif %}
              {% endif %}
            {% endunless %}

            {% comment %}Method 3: Simple contains check{% endcomment %}
            {% unless has_transcription %}
              {% if content contains "Transcription" %}
                {% assign transcription_content = content %}
                {% assign has_transcription = true %}
              {% endif %}
            {% endunless %}

            {% if has_transcription and transcription_content != "" %}
                    <!-- Collapsible transcription content -->
                  <details class="transcript-details group" open>
                    <summary class="cursor-pointer list-none flex items-center gap-3 p-4 rounded-lg border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800/50 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors duration-200 mb-6">
                      <svg class="size-5 text-saints-600 dark:text-saints-400 transition-transform duration-200 group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                      </svg>
                      <div class="flex-1">
                        <h3 class="font-medium text-stone-900 dark:text-white font-display">Full Transcription</h3>
                      </div>
                    </summary>

                    <div class="prose prose-base prose-stone dark:prose-invert max-w-none [&_p:has(br:only-child)]:hidden mt-6" itemprop="articleBody" id="sermon-transcription">
                      {{ transcription_content }}
                    </div>
                  </details>
            {% elsif page.description == nil or page.description == "" %}
              <!-- Fallback if neither content nor description exists -->
              <div class="prose prose-base prose-stone dark:prose-invert max-w-none text-center py-8">
                <p class="text-stone-600 dark:text-stone-400">Transcription coming soon...</p>
              </div>
            {% endif %}

          </div>
        </div>
      </div>

      <!-- CTA Section -->
      <div class="pt-8 mx-auto mt-8 max-w-2xl text-center border-t border-stone-200 animate-reveal dark:border-stone-800">
        <p class="mb-6 text-sm text-stone-600 dark:text-stone-400">{{ site.data.content.sermons.cta.episode_page.description }}</p>
        <div class="flex flex-col gap-3 justify-center items-stretch mx-auto max-w-sm sm:flex-row sm:items-center sm:max-w-none">
          {% include button.html href="/beliefs/" text="Our Beliefs" class="w-full sm:w-auto" %}
          {% include button.html text="Visit Us" command="show-modal" commandfor="visit-modal" class="w-full sm:w-auto" %}
        </div>
      </div>
    </article>
  </main>
</div>